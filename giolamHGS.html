<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√çNH GI·ªú L√ÄM HGS</title>
    <!-- T·∫£i Tailwind CSS ƒë·ªÉ t·∫°o giao di·ªán ƒë·∫πp v√† responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ƒê·∫£m b·∫£o chi·ªÅu r·ªông c·ªßa th·∫ª textarea kh√¥ng v∆∞·ª£t qu√° th·∫ª cha */
        textarea {
            resize: vertical;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8 font-sans">

    <div id="app" class="max-w-4xl mx-auto bg-white shadow-2xl rounded-xl p-6 md:p-10">
        <h1 class="3xl sm:text-4xl font-extrabold text-blue-700 mb-2">
            ‚è∞ T√çNH GI·ªú L√ÄM HGS
        </h1>
        <p class="text-gray-600 mb-6 border-b pb-4">
            ·ª®ng d·ª•ng s·∫Ω ph√¢n t√≠ch c√°c k√Ω hi·ªáu ƒëi·ªÅu ch·ªânh (`1X`, `X-1`, v.v.) ƒë·ªÉ t√≠nh ra gi·ªù L√™n ca v√† K·∫øt th√∫c ca ch√≠nh x√°c, k√®m theo t·ªïng gi·ªù l√†m.
        </p>

        <!-- B·∫£ng ƒê·ªãnh Nghƒ©a K√Ω Hi·ªáu -->
        <div class="mb-8 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <h2 class="text-lg font-semibold text-blue-800 mb-2">Quy ∆Ø·ªõc K√Ω Hi·ªáu & Gi·ªù C∆° B·∫£n</h2>
            <div id="shift-definitions" class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm font-medium">
                <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn b·∫±ng JavaScript -->
            </div>
            <!-- ƒê√£ lo·∫°i b·ªè ph·∫ßn Quy T·∫Øc ƒêi·ªÅu Ch·ªânh (Modifier) kh·ªèi giao di·ªán -->
        </div>


        <!-- Khu v·ª±c Nh·∫≠p Li·ªáu M·ªõi -->
        <div class="mb-6">
            <label class="block text-lg font-medium text-gray-700 mb-4">
                Nh·∫≠p K√Ω Hi·ªáu Ca Theo Ng√†y Trong Tu·∫ßn
            </label>
            <div id="dayShiftInputs" class="grid grid-cols-4 sm:grid-cols-7 gap-3">
                <!-- Input fields for T2 to CN will be generated by JavaScript -->
            </div>
        </div>

        <!-- N√∫t T√≠nh To√°n -->
        <div class="flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0 sm:space-x-4">
            <button
                id="calculateButton"
                class="w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-bold rounded-full shadow-lg hover:bg-blue-700 transition duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300"
                onclick="calculateTotalHours()"
            >
                üî• T√≠nh Gi·ªù Ca & T·ªïng C√¥ng
            </button>
            <button
                id="resetButton"
                class="w-full sm:w-auto px-8 py-3 bg-red-500 text-white font-bold rounded-full shadow-lg hover:bg-red-600 transition duration-200 focus:outline-none focus:ring-4 focus:ring-red-300"
                onclick="resetApp()"
            >
                X√≥a B·ªè
            </button>
        </div>


        <!-- Khu v·ª±c K·∫øt Qu·∫£ -->
        <div id="results" class="mt-8 pt-6 border-t-2 border-blue-200 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">K·∫øt Qu·∫£ Chuy·ªÉn ƒê·ªïi & T·ªïng C√¥ng</h2>

            <!-- T·ªïng Quan -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-green-100 p-4 rounded-xl shadow-md border-l-4 border-green-500">
                    <p class="text-sm font-medium text-green-700">T·ªïng S·ªë Ca L√†m (C√≥ Gi·ªù)</p>
                    <p id="totalShifts" class="text-3xl font-extrabold text-green-900 mt-1">0</p>
                </div>
                <div class="bg-indigo-100 p-4 rounded-xl shadow-md border-l-4 border-indigo-500 md:col-span-2">
                    <p class="text-sm font-medium text-indigo-700">T·ªïng S·ªë Gi·ªù C√¥ng ƒê√£ T√≠nh (L√†m Tr√≤n)</p>
                    <p id="totalHours" class="text-4xl font-extrabold text-indigo-900 mt-1">0.0 gi·ªù</p>
                </div>
            </div>

            <!-- Th·ªëng k√™ chi ti·∫øt t·ª´ng ca ƒë√£ t√≠nh -->
            <h3 class="text-xl font-semibold text-gray-700 mb-3">Chi Ti·∫øt Gi·ªù L√™n Ca / K·∫øt Th√∫c Ca (ƒê∆°n v·ªã 24h)</h3>
            <div id="detailedStats" class="space-y-2">
                <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn b·∫±ng JavaScript -->
            </div>

            <!-- Khu v·ª±c C·∫£nh b√°o l·ªói -->
            <div id="errorWarning" class="hidden mt-6 p-4 bg-yellow-100 text-yellow-800 rounded-lg border-l-4 border-yellow-500">
                <p class="font-bold">‚ö†Ô∏è C·∫£nh B√°o L·ªói Nh·∫≠p Li·ªáu:</p>
                <p id="unknownShifts" class="mt-1 text-sm"></p>
            </div>
        </div>
    </div>

    <script>
        // M·∫£ng c√°c ng√†y trong tu·∫ßn (T2 - CN)
        const DAYS_OF_WEEK = ["T2", "T3", "T4", "T5", "T6", "T7", "CN"];
        
        // 1. C√ÅC H√ÄM TI·ªÜN √çCH CHUY·ªÇN ƒê·ªîI TH·ªúI GIAN
        
        /** Chuy·ªÉn ƒë·ªïi chu·ªói th·ªùi gian (HhMM ho·∫∑c Hh.MM) sang Decimal Hours (vd: '7h30' -> 7.5) */
        function timeToDecimal(timeStr) {
            const parts = timeStr.split('h');
            const hours = parseInt(parts[0], 10);
            const minutes = parts.length > 1 ? (parseInt(parts[1] || '0', 10) / 60) : 0;
            return hours + minutes;
        }

        /** Chuy·ªÉn ƒë·ªïi Decimal Hours sang chu·ªói th·ªùi gian HH:MM (vd: 7.5 -> '07:30') */
        function decimalToTimeStr(decimalHours) {
            // ƒê·∫£m b·∫£o th·ªùi gian n·∫±m trong kho·∫£ng 0-24 (ho·∫∑c 24-48 cho ca ƒë√™m)
            const hours24 = decimalHours % 24;
            const hours = Math.floor(hours24);
            const minutes = Math.round((hours24 - hours) * 60);

            const hStr = String(hours).padStart(2, '0');
            const mStr = String(minutes).padStart(2, '0');
            return `${hStr}:${mStr}`;
        }
        
        // 2. ƒê·ªäNH NGHƒ®A C√ÅC CA L√ÄM VI·ªÜC (S·ª≠ d·ª•ng Decimal Hours cho t√≠nh to√°n)
        const SHIFT_HOURS = {
            // start v√† end ƒë∆∞·ª£c l∆∞u d∆∞·ªõi d·∫°ng chu·ªói ƒë·ªÉ hi·ªÉn th·ªã, nh∆∞ng duration v√† decimalStart l√† s·ªë
            'HC': { name: 'H√†nh Ch√≠nh', start: '7h30', end: '15h30', decimalStart: 7.5, duration: 8.0, color: 'blue' },
            'S': { name: 'Ca S√°ng', start: '6h', end: '14h', decimalStart: 6.0, duration: 8.0, color: 'green' },
            'X': { name: 'Ca Chi·ªÅu', start: '14h', end: '22h', decimalStart: 14.0, duration: 8.0, color: 'purple' },
            // Ca ƒë√™m 'A' k·∫øt th√∫c l√∫c 6h s√°ng h√¥m sau, n√™n l√† 22.0 ƒë·∫øn 30.0 (t·ª©c 6.0)
            'A': { name: 'Ca ƒê√™m', start: '22h', end: '6h', decimalStart: 22.0, duration: 8.0, color: 'indigo' },
            'N': { name: 'Ng√†y Ngh·ªâ', start: '0h', end: '0h', decimalStart: 0.0, duration: 0.0, color: 'red' },
        };

        const dayShiftInputsDiv = document.getElementById('dayShiftInputs');
        const resultsDiv = document.getElementById('results');
        const totalHoursSpan = document.getElementById('totalHours');
        const totalShiftsSpan = document.getElementById('totalShifts');
        const detailedStatsDiv = document.getElementById('detailedStats');
        const errorWarningDiv = document.getElementById('errorWarning');
        const unknownShiftsP = document.getElementById('unknownShifts');
        const definitionsDiv = document.getElementById('shift-definitions');

        // H√†m hi·ªÉn th·ªã quy ∆∞·ªõc k√Ω hi·ªáu (gi·ªØ nguy√™n)
        function renderShiftDefinitions() {
            definitionsDiv.innerHTML = ''; 
            for (const key in SHIFT_HOURS) {
                const shift = SHIFT_HOURS[key];
                const timeRange = shift.duration > 0 ? `${shift.start} - ${shift.end}` : 'Ngh·ªâ';
                const html = `
                    <div class="flex items-center space-x-2">
                        <span class="font-extrabold text-2xl text-${shift.color}-600">${key}</span>
                        <span class="text-gray-700">${shift.name}: <span class="font-bold">${shift.duration.toFixed(1)} gi·ªù</span> (${timeRange})</span>
                    </div>
                `;
                definitionsDiv.innerHTML += html;
            }
        }
        
        /**
         * H√†m t·∫°o c√°c √¥ input cho 7 ng√†y trong tu·∫ßn
         */
        function renderDayInputs() {
            dayShiftInputsDiv.innerHTML = DAYS_OF_WEEK.map(day => `
                <div class="flex flex-col">
                    <label for="shift_${day}" class="text-xs font-semibold text-gray-600 mb-1">${day}</label>
                    <input 
                        type="text" 
                        id="shift_${day}" 
                        data-day="${day}"
                        placeholder="VD: HC, 2X-1" 
                        class="p-2 border-2 border-gray-300 rounded-lg text-sm uppercase focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                    >
                </div>
            `).join('');
            
            // D·ªØ li·ªáu m·∫´u minh h·ªça logic M·ªöI:
            // T2: 1A-5 (L√™n s·ªõm 1h, V·ªÅ s·ªõm 5h) -> 21:00 - 01:00 -> 4.0h
            // T4: 2X (L√™n s·ªõm 2h) -> 12:00 - 22:00 -> 10.0h
            // T5: X1 (V·ªÅ mu·ªôn 1h) -> 14:00 - 23:00 -> 9.0h
            // T7: S-1 (V·ªÅ s·ªõm 1h) -> 6:00 - 13:00 -> 7.0h
            const initialData = {
                "T2": "1A-5", 
                "T3": "HC", 
                "T4": "2X", 
                "T5": "X1", 
                "T6": "N", 
                "T7": "S-1", 
                "CN": "A"
            };
            
            DAYS_OF_WEEK.forEach(day => {
                const inputElement = document.getElementById(`shift_${day}`);
                if (inputElement && initialData[day]) {
                    inputElement.value = initialData[day];
                }
            });
        }


        /**
         * Ph√¢n t√≠ch chu·ªói ca l√†m ph·ª©c t·∫°p (v√≠ d·ª•: '1X-1', '2-X') v√† t√≠nh to√°n gi·ªù L√™n/K·∫øt th√∫c ca.
         * @param {string} shiftCodeString - Chu·ªói ca l√†m (v√≠ d·ª•: 'HC', '1X-1', '2-X', 'S2').
         * @returns {object} - { baseCode, hours, isKnown, actualStart, actualEnd, startShiftHours, endShiftHours }
         */
        function parseShift(shiftCodeString) {
            // Regex: Group 1 (Prefix), Group 2 (BaseCode), Group 3 (Suffix)
            // ^(\d*[+-]?\d*)?([A-Z]+)([+-]?\d*)$
            // Group 1: B·∫•t k·ª≥ s·ªë n√†o, theo sau l√† +/- (optional) HO·∫∂C ch·ªâ s·ªë (d√†nh cho L√äN S·ªöM)
            // Group 2: K√Ω hi·ªáu ca (X, S, A, HC)
            // Group 3: +/- s·ªë (d√†nh cho V·ªÄ MU·ªòN/S·ªöM) HO·∫∂C ch·ªâ s·ªë (d√†nh cho V·ªÄ MU·ªòN)
            const regex = /^(\d*[+-]?\d*)?([A-Z]+)([+-]?\d*)$/;
            const match = shiftCodeString.match(regex);
            
            // Tr∆∞·ªùng h·ª£p ca ƒë∆°n gi·∫£n ho·∫∑c ca ngh·ªâ
            if (!match) {
                const simpleShift = SHIFT_HOURS[shiftCodeString];
                if (simpleShift) {
                    const start = simpleShift.decimalStart;
                    const end = simpleShift.decimalStart + simpleShift.duration;
                    return { 
                        code: shiftCodeString, 
                        baseCode: shiftCodeString, 
                        hours: simpleShift.duration, 
                        isKnown: true, 
                        actualStart: decimalToTimeStr(start),
                        actualEnd: decimalToTimeStr(end),
                        startShiftHours: 0,
                        endShiftHours: 0,
                        color: simpleShift.color
                    };
                }
                return { code: shiftCodeString, baseCode: shiftCodeString, hours: 0, isKnown: false };
            }

            const prefixMod = match[1] || '';   
            const baseCode = match[2];          
            const suffixMod = match[3] || '';   

            const baseShift = SHIFT_HOURS[baseCode];

            if (!baseShift) {
                return { code: shiftCodeString, baseCode: baseCode, hours: 0, isKnown: false };
            }

            // 3. T√≠nh to√°n Gi·ªù B·∫Øt ƒê·∫ßu v√† Gi·ªù K·∫øt Th√∫c c∆° s·ªü (d·∫°ng decimal)
            const baseStart = baseShift.decimalStart; // Gi·ªù b·∫Øt ƒë·∫ßu m·∫∑c ƒë·ªãnh
            // Gi·ªù k·∫øt th√∫c m·∫∑c ƒë·ªãnh. ƒê·ªëi v·ªõi ca ƒë√™m (A), ƒë√¢y l√† gi√° tr·ªã > 24 (vd: 30.0)
            const baseEnd = baseShift.decimalStart + baseShift.duration; 
            
            let currentStart = baseStart; // Gi·ªù b·∫Øt ƒë·∫ßu th·ª±c t·∫ø
            let currentEnd = baseEnd;     // Gi·ªù k·∫øt th√∫c th·ª±c t·∫ø
            
            let startShiftHours = 0; 
            let endShiftHours = 0;   
            
            // 4. √Åp d·ª•ng Prefix Modifier (Thay ƒë·ªïi gi·ªù B·∫ÆT ƒê·∫¶U - ƒê·ªòC L·∫¨P)
            if (prefixMod) {
                const numericPart = prefixMod.replace(/[+-]/g, '');
                const modValue = parseFloat(numericPart);
                
                let adjustment = 0;

                if (prefixMod.includes('-') || prefixMod.includes('+')) {
                    // L√™n Mu·ªôn -> C·ªông gi·ªù (Start + N)
                    adjustment = modValue;
                    startShiftHours = modValue;
                } else if (prefixMod.match(/^\d+$/)) { 
                    // L√™n S·ªõm -> Tr·ª´ gi·ªù (Start - N)
                    adjustment = -modValue;
                    startShiftHours = -modValue;
                }
                
                currentStart += adjustment;
                // N·∫øu KH√îNG C√ì suffix mod, ta d·ªãch chuy·ªÉn c·∫£ currentEnd ƒë·ªÉ gi·ªØ duration c∆° b·∫£n 
                // L∆ØU √ù: N·∫øu c√≥ Suffix Mod, d√≤ng n√†y s·∫Ω b·ªã ghi ƒë√® sau, ƒë·∫£m b·∫£o Suffix ch·ªâ √°p d·ª•ng cho BaseEnd
                currentEnd = baseEnd + adjustment; 
            }
            
            // 5. √Åp d·ª•ng Suffix Modifier (Thay ƒë·ªïi gi·ªù K·∫æT TH√öC - ƒê·ªòC L·∫¨P)
            if (suffixMod) {
                const modValue = parseFloat(suffixMod.replace(/[+-]/g, ''));
                
                if (suffixMod.match(/^\d+$/) || suffixMod.startsWith('+')) { 
                    // V·ªÅ mu·ªôn -> End + N
                    endShiftHours = modValue;
                } else if (suffixMod.startsWith('-')) { 
                    // V·ªÅ s·ªõm -> End - N
                    endShiftHours = -modValue; // G√°n gi√° tr·ªã √¢m cho ƒëi·ªÅu ch·ªânh V·ªÅ S·ªõm
                }
                
                // C√†i ƒë·∫∑t l·∫°i currentEnd b·∫±ng Gi·ªù K·∫øt th√∫c M·∫∑c ƒë·ªãnh (baseEnd) + ƒêi·ªÅu ch·ªânh V·ªÅ ca (endShiftHours).
                // Vi·ªác n√†y ƒë·∫£m b·∫£o Suffix Mod ch·ªâ t√°c ƒë·ªông l√™n gi·ªù k·∫øt th√∫c, ƒë·ªôc l·∫≠p v·ªõi Prefix Mod
                currentEnd = baseEnd + endShiftHours; 
            }
            
            // 6. T√≠nh to√°n l·∫°i Duration v√† chu·∫©n h√≥a gi·ªù (ƒë·∫£m b·∫£o kh√¥ng √¢m)
            const finalDuration = Math.max(0, currentEnd - currentStart);
            
            return {
                code: shiftCodeString,
                baseCode: baseCode,
                hours: finalDuration,
                isKnown: true,
                actualStart: decimalToTimeStr(currentStart),
                actualEnd: decimalToTimeStr(currentEnd),
                startShiftHours: startShiftHours,
                endShiftHours: endShiftHours,
                color: baseShift.color
            };
        }

        // 7. H√ÄM CH√çNH TH·ª∞C HI·ªÜN T√çNH TO√ÅN
        function calculateTotalHours() {
            // Reset UI
            resultsDiv.classList.add('hidden');
            errorWarningDiv.classList.add('hidden');
            detailedStatsDiv.innerHTML = '';
            unknownShiftsP.textContent = '';

            // 1. Thu th·∫≠p d·ªØ li·ªáu t·ª´ c√°c √¥ input 7 ng√†y
            const shiftsToProcess = [];
            DAYS_OF_WEEK.forEach(day => {
                const inputElement = document.getElementById(`shift_${day}`);
                const rawInput = inputElement ? inputElement.value.trim().toUpperCase() : '';
                // Ph√¢n t√°ch c√°c ca n·∫øu ng∆∞·ªùi d√πng nh·∫≠p nhi·ªÅu ca trong 1 ng√†y (vd: HC, 2X)
                const codes = rawInput.split(/[\s,]+/g).filter(s => s.length > 0); 
                
                codes.forEach(code => {
                    shiftsToProcess.push({ day, code });
                });
            });


            let totalHours = 0;
            let totalShiftsCount = 0;
            const detailedShiftsList = [];
            const unknownShifts = new Set();
            
            // 2. X·ª≠ l√Ω t·ª´ng ca
            shiftsToProcess.forEach(({ day, code }) => {
                const result = parseShift(code);
                
                if (result.isKnown) {
                    totalHours += result.hours;
                    if (result.hours > 0) {
                        totalShiftsCount++;
                    }
                    result.day = day; // G·∫Øn th√¥ng tin ng√†y v√†o k·∫øt qu·∫£
                    detailedShiftsList.push(result);
                } else {
                    unknownShifts.add(code);
                }
            });

            // 8. HI·ªÇN TH·ªä K·∫æT QU·∫¢ T·ªîNG QUAN
            totalHoursSpan.textContent = `${totalHours.toFixed(1)} gi·ªù`;
            totalShiftsSpan.textContent = totalShiftsCount;
            if (totalShiftsCount > 0 || unknownShifts.size > 0) {
                resultsDiv.classList.remove('hidden');
            }
            

            // 9. HI·ªÇN TH·ªä CHI TI·∫æT GI·ªú L√äN/K·∫æT TH√öC CA
            detailedShiftsList.forEach((shift, index) => {
                const isShift = shift.hours > 0;
                
                if (!isShift) {
                    // X·ª≠ l√Ω ca ngh·ªâ (N)
                    const detailHtml = `
                        <div class="p-4 bg-gray-100 rounded-xl border-l-4 border-red-500 shadow-md">
                            <span class="text-xl font-bold text-gray-800">${shift.day}: Ca ${shift.code} (Ng√†y Ngh·ªâ)</span>
                            <span class="block text-sm font-normal text-red-500 mt-1">Kh√¥ng c√≥ gi·ªù l√†m</span>
                        </div>
                    `;
                    detailedStatsDiv.innerHTML += detailHtml;
                    return;
                }

                const baseShift = SHIFT_HOURS[shift.baseCode];
                const baseStartStr = decimalToTimeStr(baseShift.decimalStart);
                const baseEndStr = decimalToTimeStr(baseShift.decimalStart + baseShift.duration);
                
                // Hi·ªÉn th·ªã ƒëi·ªÅu ch·ªânh: L√™n ca
                const startModHours = Math.abs(shift.startShiftHours);
                const startModSign = shift.startShiftHours > 0 ? '+' : (shift.startShiftHours < 0 ? '-' : '');
                const startModText = shift.startShiftHours > 0 ? 'Mu·ªôn' : (shift.startShiftHours < 0 ? 'S·ªõm' : 'Kh√¥ng ƒë·ªïi');
                
                // Hi·ªÉn th·ªã ƒëi·ªÅu ch·ªânh: V·ªÅ ca
                const endModHours = Math.abs(shift.endShiftHours);
                const endModSign = shift.endShiftHours > 0 ? '+' : (shift.endShiftHours < 0 ? '-' : '');
                const endModText = shift.endShiftHours > 0 ? 'Mu·ªôn' : (shift.endShiftHours < 0 ? 'S·ªõm' : 'Kh√¥ng ƒë·ªïi');

                const adjustmentRowHtml = `
                    <div class="grid grid-cols-3 gap-2 text-sm text-gray-700 bg-white p-3 rounded-lg shadow-inner">
                        <div class="font-semibold text-gray-500">Gi·ªù c∆° b·∫£n:</div>
                        <div class="col-span-2 font-bold">${baseStartStr} - ${baseEndStr} (${baseShift.duration.toFixed(1)}h)</div>

                        <div class="font-semibold text-gray-500">ƒêi·ªÅu ch·ªânh L√™n ca:</div>
                        <div class="col-span-2 font-bold ${shift.startShiftHours < 0 ? 'text-green-600' : (shift.startShiftHours > 0 ? 'text-red-600' : 'text-gray-600')}">${startModSign}${startModHours.toFixed(1)} gi·ªù 
                            <span class="text-xs text-gray-500">(${startModText})</span>
                        </div>

                        <div class="font-semibold text-gray-500">ƒêi·ªÅu ch·ªânh V·ªÅ ca:</div>
                        <div class="col-span-2 font-bold ${shift.endShiftHours > 0 ? 'text-green-600' : (shift.endShiftHours < 0 ? 'text-red-600' : 'text-gray-600')}">${endModSign}${endModHours.toFixed(1)} gi·ªù 
                            <span class="text-xs text-gray-500">(${endModText})</span>
                        </div>
                        
                        <div class="font-semibold text-gray-900 mt-2 border-t pt-2">GI·ªú TH·ª∞C T·∫æ (L√™n - K·∫øt th√∫c):</div>
                        <div class="col-span-2 font-extrabold text-blue-700 mt-2 border-t pt-2 text-xl">${shift.actualStart} - ${shift.actualEnd}</div>
                    </div>
                `;

                const detailHtml = `
                    <div class="space-y-3 p-4 bg-gray-100 rounded-xl border-l-4 border-${shift.color}-500 shadow-md">
                        <div class="flex justify-between items-center pb-2 border-b border-gray-300">
                            <span class="text-xl font-bold text-gray-800">${shift.day}: Ca ${shift.code} (${SHIFT_HOURS[shift.baseCode].name})</span>
                            <span class="text-2xl font-extrabold text-indigo-700">${shift.hours.toFixed(1)}h</span>
                        </div>
                        ${adjustmentRowHtml}
                    </div>
                `;
                detailedStatsDiv.innerHTML += detailHtml;
            });

            // 10. HI·ªÇN TH·ªä C·∫¢NH B√ÅO L·ªñI (n·∫øu c√≥)
            if (unknownShifts.size > 0) {
                errorWarningDiv.classList.remove('hidden');
                unknownShiftsP.textContent = `C√°c k√Ω hi·ªáu kh√¥ng x√°c ƒë·ªãnh ho·∫∑c kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng ƒë√£ b·ªã b·ªè qua: ${Array.from(unknownShifts).join(', ')}. Vui l√≤ng ki·ªÉm tra l·∫°i.`;
            }
        }

        // H√†m ƒë·∫∑t l·∫°i ·ª©ng d·ª•ng
        function resetApp() {
            DAYS_OF_WEEK.forEach(day => {
                const inputElement = document.getElementById(`shift_${day}`);
                if (inputElement) {
                    inputElement.value = '';
                }
            });
            resultsDiv.classList.add('hidden');
            errorWarningDiv.classList.add('hidden');
            totalHoursSpan.textContent = '0.0 gi·ªù';
            totalShiftsSpan.textContent = '0';
            detailedStatsDiv.innerHTML = '';
        }

        // Kh·ªüi ch·∫°y
        document.addEventListener('DOMContentLoaded', () => {
            renderShiftDefinitions();
            renderDayInputs();
            calculateTotalHours();
        });
    </script>
</body>
</html>
